{% extends "base.html" %}

{% block title %}Login - NomeBanca{% endblock %}

{% block navbar %}{% endblock %}

{% block content %}

<div class="d-flex justify-content-center align-items-center">
    <div class="card shadow p-4 card-login" style="max-width: 400px; width: 100%;">

        <h4 class="text-center mb-4">
            Benvenuto in <strong>U.T.P. Banca Cascella</strong>
        </h4>

        <form action="{{ url_for('login') }}" method="POST">

            <!-- Codice Titolare -->
            <div class="form-floating mb-3">
                <input type="text" id="codice_titolare" name="codice_titolare" placeholder=" " required>
                <label for="codice_titolare">Codice Titolare</label>
            </div>

            <!-- PIN -->
            <div class="mb-3 position-relative">

                <div class="form-floating">
                    <input type="password" id="pin" inputmode="numeric" maxlength="6" name="pin" placeholder=" " required>
                    <label for="pin">PIN</label>
                </div>

                <!-- Icona mostra/nascondi password -->
                <button type="button" onclick="mostraPassword()" class="btn btn-sm btn-outline-secondary position-absolute"
                        style="top: 15px; right: 10px; border-radius: 50%; padding: 5px 8px;">
                    <img src="/static/show-password.png" id="imgpass" width="20" alt="Mostra Password">
                </button>
            </div>

            <button type="submit" class="btn btn-primary w-100 py-2 mt-3">
                ACCEDI
            </button>

        </form>
    </div>
</div>

<!-- SCRIPT MOSTRA PASSWORD -->
<script>
    function mostraPassword() {
        const img = document.getElementById('imgpass');
        const pin = document.getElementById('pin');

        if (pin.type === "password") {
            pin.type = "text";
            img.src = "/static/hide-password.png";
        } else {
            pin.type = "password";
            img.src = "/static/show-password.png";
        }
    }
</script>

<!-- SCRIPT PIN SOLO NUMERI -->
<script>
    const pinInput = document.getElementById('pin');

    pinInput.addEventListener('keydown', (e) => {
        const allowed = ['Backspace','Tab','ArrowLeft','ArrowRight','Delete','Home','End'];
        if (allowed.includes(e.key) || e.metaKey || e.ctrlKey) return;
        if (!/^[0-9]$/.test(e.key)) e.preventDefault();
    });

    pinInput.addEventListener('paste', (e) => {
        e.preventDefault();
        const text = (e.clipboardData || window.clipboardData).getData('text');
        const digits = text.replace(/\D+/g, '');
        const max = pinInput.maxLength || Infinity;
        const remain = max - pinInput.value.length;
        pinInput.setRangeText(digits.slice(0, remain), pinInput.selectionStart, pinInput.selectionEnd, 'end');
    });

    pinInput.addEventListener('input', () => {
        pinInput.value = pinInput.value.replace(/\D+/g, '');
    });
</script>

{% endblock %}


